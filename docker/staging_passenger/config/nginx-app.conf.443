server {
    listen 80;
    server_name homologacao-tcc-docker.ifes.br;

    rewrite ^/(.*) https://homologacao-tcc-docker.ifes.br/$1 permanent;
}

server {
    listen 443 ssl;
    server_name homologacao-tcc-docker.ifes.br;

    root /home/app/repo/public;

    passenger_enabled on;
    passenger_user app;
    passenger_app_env production;
    passenger_ruby /usr/local/rvm/wrappers/ruby-2.2.10@sistema-tcc/ruby;
    passenger_min_instances 8;
    client_max_body_size 100m;
    client_body_buffer_size 128k;

    ssl_certificate /etc/ssl/certs_app/cert.crt;
    ssl_certificate_key /etc/ssl/certs_app/cert.key;

    ssl_session_timeout 5m;

    ssl_protocols SSLv3 TLSv1;
    ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv3:+EXP;
    ssl_prefer_server_ciphers on;

    location ~ ^/assets/ {
        gzip_static on; # to serve pre-gzipped version
        gzip_vary on;
        expires max;
        add_header  ETag "";
        add_header  Cache-Control public;
        break;
    }

    location ~^/images/ {
        expires max;
        add_header  Cache-Control public;
        break;
    }

}

passenger_pre_start https://homologacao-tcc-docker.ifes.br;